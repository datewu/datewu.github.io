---
title: "è®¾ç½®dns"
description: è®¾ç½®macos dnsè§£ææœåŠ¡å™¨
date: 2020-06-10T22:20:03+08:00
tags: [
    "macos",
    "dns",
    "networksetup",
    "setdnsservers",
]
categories: [
    "è¿ç»´",
]
cover:
  image: dns-resolver.png
draft: false
---
ä¼—æ‰€å‘¨çŸ¥ï¼Œä¿®æ”¹[`/etc/resolv.conf`](https://en.wikipedia.org/wiki/Resolv.conf)é…ç½®æ–‡ä»¶å¯ä»¥é…ç½®Linuxçš„dns è§£ææœåŠ¡å™¨ã€‚
```shell
[root@VM-8-3-centos ~]# cat /etc/resolv.conf 
# Generated by NetworkManager
nameserver 183.60.83.19
nameserver 183.60.82.98
```

é‚£ä¹ˆè‹¹æœç³»ç»Ÿçš„dns è§£ææœåŠ¡å™¨åº”è¯¥åœ¨å“ªé‡Œé…ç½®å‘¢ï¼Œä¹Ÿæ˜¯é…ç½®/etc/resolv.confæ–‡ä»¶å—ï¼Ÿ
```shell
âœ  ~ cat /etc/resolv.conf 
# macOS Notice
#
# This file is not consulted for DNS hostname resolution, address
# resolution, or the DNS query routing mechanism used by most
# processes on this system.
#
# To view the DNS configuration used by this system, use:
#   scutil --dns
#
# SEE ALSO
#   dns-sd(1), scutil(8)
#
# This file is automatically generated.
#
nameserver 127.0.0.1
nameserver 192.168.1.1
```

## æ•…äº‹

å› ä¸ºæ–°å† çš„çˆ†å‘ï¼Œå…¬å¸ä¸‹æ”¾äº†VPNæƒé™ï¼Œå¯ä»¥åœ¨å®¶æ¥å…¬å¸åŠå…¬ç½‘ç»œåŠå…¬ã€‚

è¿™æ®µæ—¶é—´æˆ‘åœ¨å®¶äº«å—ä¸æ»‘é¡ºç•…çš„åŠå…¬å†…ç½‘ç½‘ç»œï¼ŒåŸºæœ¬æ²¡é‡åˆ°å•¥é—®é¢˜ï¼Œæ¯å¤©éƒ½ç¾æ»‹æ»‹çš„ã€‚

æ˜¨å¤©æ‰‹æœºè¿è¥å•†**è”é€š**çªç„¶æ‰“ç”µè¯ç»™æˆ‘è¯´ï¼Œæˆ‘çš„æ‰‹æœºæ˜¯5Gæ‰‹æœºï¼Œè®¾ç½®ä¸€ä¸‹ç½‘ç»œæ¨¡å¼å¯ä»¥åœ¨åŸæœ‰4Gçš„å¥—é¤ä¸Šä½¿ç”¨5Gç½‘ç»œå•¦ï¼Œè¯šé‚€æˆ‘ä½“éªŒã€‚

é‚£ä¹ˆ**è”é€š**æ˜¯**æ€ä¹ˆçŸ¥é“**æˆ‘ä½¿ç”¨çš„æ˜¯5Gæ‰‹æœºçš„å‘¢ï¼Ÿï¼Ÿï¼Ÿè¿™ä¸ªå…ˆæŒ‰ä¸‹ä¸è¡¨ã€‚

æˆ‘ç¨ç¨ä½“éªŒäº†ä¸€ä¼šï¼Œ5Gç½‘ç»œçš„é€Ÿåº¦å’Œæ—¶å»¶æœç„¶å’Œå®£ä¼ ä¸­çš„ä¸€æ ·ç‰›é€¼ã€‚

æˆ‘ä¸ç”±çš„æ„Ÿå¹ï¼šåä¸ºæœç„¶ğŸ‚ğŸºã€‚


è¿™ä¹ˆå¥½çš„ç½‘ç»œè´¨é‡ï¼Œä¸åº”è¯¥è®©ç¬”è®°æœ¬ä¹Ÿäº«å—äº«å—å—ï¼Ÿ

è¯ä¸å¤šè¯´æˆ‘ç«‹é©¬æŠŠè‹¹æœç”µè„‘è¿æ¥ä¸Šäº†æ‰‹æœºçƒ­ç‚¹ï¼Œç”¨äº†ä¸å¤šä¹…å°±å‘ç°é‡åˆ°äº†DNSçš„é—®é¢˜ã€‚

### é—®é¢˜
è‹¹æœç¬”è®°æœ¬è¿æ¥æ‰‹æœºçƒ­ç‚¹çš„Wi-Fiåï¼Œæ‰‹æœºçƒ­ç‚¹ ä¸ä¼šä½¿ç”¨ VPNæŒ‡å®šçš„DNS serverå»è§£æ åŠå…¬ç½‘ç»œçš„å†…ç½‘åœ°å€ï¼Œå¯¼è‡´æ— å¦¨è®¿é—®å†…ç½‘åŸŸåã€‚

### è§£å†³æ–¹æ¡ˆ
è§£å†³çš„åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼šæ‰“å¼€ è®¾ç½®-> ç½‘ç»œ -> WI-Fi -> é«˜çº§ -> DNS -> ä¿®æ”¹DNS æœåŠ¡å™¨ å³å¯ã€‚

é¼“æ£ä¸€ä¼šå‘ç°ï¼Œæ¯æ¬¡æ“ä½œdns serveréƒ½éœ€è¦ç”¨é¼ æ ‡ç‚¹å‡»UIï¼Œå†ç‚¹å‡»6æ¬¡å­èœå•ï¼Œå¤åˆ¶ä¸¤æ¬¡DNS server çš„IP åœ°å€ï¼Œæ‰èƒ½å®Œæˆè®¾ç½®ï¼Œè¿™ç§æ“ä½œå¾ˆä¸ç¨‹åºå‘˜ã€‚

äºæ˜¯æœç´¢äº†macosè®¾ç½®dns serversçš„å‘½ä»¤ï¼ŒæŠŠä¸Šé¢çš„UIæ“ä½œè„šæœ¬åŒ–äº†ã€‚æ•´ç†äº†ä¸€ä»½`bash`è„šæœ¬å¦‚ä¸‹ï¼š
```bash
#!/usr/local/bin/bash
a=${1:-check}
echo ${a}ing ...

#dns="100.67.174.10 100.67.174.11"
dns="100.67.174.10 100.67.174.11"

if [ $a = "check" ]
then
    networksetup -getinfo wi-fi
    echo ""
    networksetup -getdnsservers wi-fi
fi


if [ $a = "set" ]
then
    networksetup -setdnsservers wi-fi $dns
    echo ""
    networksetup -getdnsservers wi-fi
fi

if [ $a = "clear" ]
then
    networksetup -setdnsservers wi-fi Empty
    echo ""
    networksetup -getdnsservers wi-fi
fi

echo ""
echo $a successed!
```

è„šæœ¬æ”¯æŒ3ä¸ªå‚æ•° `check`,`set`å’Œ `clear`ï¼Œé»˜è®¤ä½¿ç”¨ `check`å‚æ•°ã€‚

ä¿å­˜ä¸º`set-dns.sh`æ–‡ä»¶ï¼Œå†åŠ ä¸Šå¯æ‰§è¡Œæƒé™å³å¯ï¼š
```shell
âœ  ~ chmod +x set-dns.sh
âœ  ~ ./set-dns.sh
```
