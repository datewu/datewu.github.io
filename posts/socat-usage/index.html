<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="简单介绍socat端口转发命令"><title>socat工具</title><link rel=canonical href=https://tab.deoops.com/posts/socat-usage/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="socat工具"><meta property="og:description" content="简单介绍socat端口转发命令"><meta property="og:url" content="https://tab.deoops.com/posts/socat-usage/"><meta property="og:site_name" content="鬼画桃符"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="linux"><meta property="article:tag" content="socat"><meta property="article:tag" content="port forward"><meta property="article:tag" content="relay"><meta property="article:published_time" content="2020-04-14T09:50:07+08:00"><meta property="article:modified_time" content="2020-04-14T09:50:07+08:00"><meta property="og:image" content="https://tab.deoops.com/posts/socat-usage/socat.jpeg"><meta name=twitter:title content="socat工具"><meta name=twitter:description content="简单介绍socat端口转发命令"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tab.deoops.com/posts/socat-usage/socat.jpeg"></head><body class="article-page has-toc"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>返回</span></a></div><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/socat-usage/><img src=/posts/socat-usage/socat_hu03f89a710279d4dc3ef9b7f10baa691c_127416_800x0_resize_q75_box.jpeg srcset="/posts/socat-usage/socat_hu03f89a710279d4dc3ef9b7f10baa691c_127416_800x0_resize_q75_box.jpeg 800w, /posts/socat-usage/socat_hu03f89a710279d4dc3ef9b7f10baa691c_127416_1600x0_resize_q75_box.jpeg 1600w" width=800 height=508 loading=lazy alt="Featured image of post socat工具"></a></div><div class=article-details><header class=article-category><a href=/categories/%E8%BF%90%E7%BB%B4/ style=background-color:#2a9d8f;color:#fff>运维</a></header><h2 class=article-title><a href=/posts/socat-usage/>socat工具</a></h2><h3 class=article-subtitle>简单介绍socat端口转发命令</h3><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Apr 14, 2020</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>阅读时长: 2 分钟</time></div></footer></div></header><section class=article-content><p>众所周知kubenetest的端口转发功能<a class=link href=https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/#forward-a-local-port-to-a-port-on-the-pod target=_blank rel=noopener>kubectl port-forward</a>非常实用，可以提高开发人员的debug效率。</p><p>其实<code>kubectl port-forward</code>的底层脏活累活都是<code>socat</code>命令在做，<code>kubectl</code>只能算是一个代理商。</p><h2 id=socat>socat</h2><h3 id=端口转发>端口转发</h3><p><code>socat tcp-listen:58812,reuseaddr,fork tcp:localhost:8000</code>把58812端口的流量转发到 8000上。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>bash-5.1# python3 -m http.server <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>bash-5.1# socat tcp-listen:58812,reuseaddr,fork tcp:localhost:8000 <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>bash-5.1# curl -I localhost:58812
</span></span><span class=line><span class=cl>HTTP/1.0 <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Server: SimpleHTTP/0.6 Python/3.10.3
</span></span><span class=line><span class=cl>Date: Thu, <span class=m>14</span> Apr <span class=m>2022</span> 03:19:15 GMT
</span></span><span class=line><span class=cl>Content-type: text/html<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8
</span></span><span class=line><span class=cl>Content-Length: <span class=m>336</span>
</span></span></code></pre></div><p>从而使得原来无法访问的 <code>localhost:8000</code>端口的服务，现在可以通过<code>*:58812</code>访问到了。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>bash-5.1# netstat -nlp 
</span></span><span class=line><span class=cl>Active Internet connections <span class=o>(</span>only servers<span class=o>)</span>
</span></span><span class=line><span class=cl>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
</span></span><span class=line><span class=cl>tcp        <span class=m>0</span>      <span class=m>0</span> 0.0.0.0:58812           0.0.0.0:*               LISTEN      10/socat
</span></span><span class=line><span class=cl>tcp        <span class=m>0</span>      <span class=m>0</span> 0.0.0.0:8000            0.0.0.0:*               LISTEN      31/python3
</span></span><span class=line><span class=cl>Active UNIX domain sockets <span class=o>(</span>only servers<span class=o>)</span>
</span></span><span class=line><span class=cl>Proto RefCnt Flags       Type       State         I-Node PID/Program name    Path
</span></span></code></pre></div><h3 id=其他>其他</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>➜  ~ tldr socat
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>socat
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Multipurpose relay <span class=o>(</span>SOcket CAT<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>- Listen to a port, <span class=nb>wait</span> <span class=k>for</span> an incoming connection and transfer data to STDIO:
</span></span><span class=line><span class=cl>    socat - TCP-LISTEN:8080,fork
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>- Create a connection to a host and port, transfer data in STDIO to connected host:
</span></span><span class=line><span class=cl>    socat - TCP4:www.example.com:80
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>- Forward incoming data of a <span class=nb>local</span> port to another host and port:
</span></span><span class=line><span class=cl>    socat TCP-LISTEN:80,fork TCP4:www.example.com:80
</span></span></code></pre></div><h2 id=语法>语法</h2><p><a class=link href=https://linux.die.net/man/1/socat target=_blank rel=noopener>man 手册</a></p><blockquote><p>Socat is a command line based utility that establishes two bidirectional byte streams and transfers data between them. Because the streams can be constructed from a large set of different types of data sinks and sources (see address types), and because lots of address options may be applied to the streams, socat can be used for many different purposes.</p></blockquote><blockquote><p>Filan is a utility that prints information about its active file descriptors to stdout. It has been written for debugging socat, but might be useful for other purposes too. Use the -h option to find more infos.</p></blockquote><blockquote><p>Procan is a utility that prints information about process parameters to stdout. It has been written to better understand some UNIX process properties and for debugging socat, but might be useful for other purposes too.</p></blockquote><blockquote><p>The life cycle of a socat instance typically consists of four phases.</p></blockquote><blockquote><p>In the init phase, the command line options are parsed and logging is initialized.</p></blockquote><blockquote><p>During the open phase, socat opens the first address and afterwards the second address. These steps are usually blocking; thus, especially for complex address types like socks, connection requests or authentication dialogs must be completed before the next step is started.</p></blockquote><blockquote><p>In the transfer phase, socat watches both streamscq read and write file descriptors via CWselect() , and, when data is available on one side and can be written to the other side, socat reads it, performs newline character conversions if required, and writes the data to the write file descriptor of the other stream, then continues waiting for more data in both directions.</p></blockquote><blockquote><p>When one of the streams effectively reaches EOF, the closing phase begins. Socat transfers the EOF condition to the other stream, i.e. tries to shutdown only its write stream, giving it a chance to terminate gracefully. For a defined time socat continues to transfer data in the other direction, but then closes all remaining channels and terminates.</p></blockquote></section><footer class=article-footer><section class=article-tags><a href=/tags/linux/>linux</a>
<a href=/tags/socat/>socat</a>
<a href=/tags/port-forward/>port forward</a>
<a href=/tags/relay/>relay</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>相关文章</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/posts/container-pid/><div class=article-image><img src=/posts/container-pid/the-matrix.7648da305198231fe1910097bf34ba73_huca438541ad881ab92ee8c66601a20268_121541_250x150_fill_q75_box_smart1.jpeg width=250 height=150 loading=lazy data-key data-hash="md5-dkjaMFGYIx/hkQCXvzS6cw=="></div><div class=article-details><h2 class=article-title>容器PID</h2></div></a></article><article class=has-image><a href=/posts/load-disk/><div class=article-image><img src=/posts/load-disk/disk.3c0ca4b5069b024bc52128389c9efda1_huc96de7ee3c2e159b1393298e71eecb80_142875_250x150_fill_q75_box_smart1.jpeg width=250 height=150 loading=lazy data-key data-hash="md5-PAyktQabAkvFISg4nJ79oQ=="></div><div class=article-details><h2 class=article-title>挂载硬盘</h2></div></a></article><article class=has-image><a href=/posts/systemd-conf/><div class=article-image><img src=/posts/systemd-conf/Systemd_components.svg loading=lazy data-key data-hash=/posts/systemd-conf/Systemd_components.svg></div><div class=article-details><h2 class=article-title>Systemd配置问题</h2></div></a></article><article class=has-image><a href=/posts/macvlan-busy/><div class=article-image><img src=/posts/macvlan-busy/maxresdefault.950f254caf2f9e23db9a50f2c7f00747_hu0c8b163f503b127644f51a05a3769b8d_73452_250x150_fill_q75_box_smart1.jpeg width=250 height=150 loading=lazy data-key data-hash="md5-lQ8lTK8vniPbmlDyx/AHRw=="></div><div class=article-details><h2 class=article-title>无法创建macvlan设备</h2></div></a></article><article class=has-image><a href=/posts/tcp-tune/><div class=article-image><img src=/posts/tcp-tune/sysctl.0086a186d14416c738a025951ff2aa1a_hue759758d58191cbb59e001a219022668_168191_250x150_fill_q75_box_smart1.jpeg width=250 height=150 loading=lazy data-key data-hash="md5-AIahhtFEFsc4oCWVH/KqGg=="></div><div class=article-details><h2 class=article-title>tcp性能调优</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2006 -
2023 鬼画桃符</section><section class=powerby>豆腐炒糖</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#socat>socat</a><ol><li><a href=#端口转发>端口转发</a></li><li><a href=#其他>其他</a></li></ol></li><li><a href=#语法>语法</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>