<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="使用docker搭建本地clickhouse使用环境"><title>clickhouse初始化</title><link rel=canonical href=https://tab.deoops.com/posts/clickhouse-start/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="clickhouse初始化"><meta property="og:description" content="使用docker搭建本地clickhouse使用环境"><meta property="og:url" content="https://tab.deoops.com/posts/clickhouse-start/"><meta property="og:site_name" content="鬼画桃符"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="clickhouse"><meta property="article:tag" content="docker"><meta property="article:tag" content="golang"><meta property="article:tag" content="database"><meta property="article:published_time" content="2021-11-22T18:39:03+08:00"><meta property="article:modified_time" content="2021-11-22T18:39:03+08:00"><meta property="og:image" content="https://tab.deoops.com/posts/clickhouse-start/clickhouse.jpeg"><meta name=twitter:title content="clickhouse初始化"><meta name=twitter:description content="使用docker搭建本地clickhouse使用环境"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tab.deoops.com/posts/clickhouse-start/clickhouse.jpeg"></head><body class="article-page has-toc"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>返回</span></a></div><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/clickhouse-start/><img src=/posts/clickhouse-start/clickhouse_hub7dd4e615b930761deceea7e40c4982b_81259_800x0_resize_q75_box.jpeg srcset="/posts/clickhouse-start/clickhouse_hub7dd4e615b930761deceea7e40c4982b_81259_800x0_resize_q75_box.jpeg 800w, /posts/clickhouse-start/clickhouse_hub7dd4e615b930761deceea7e40c4982b_81259_1600x0_resize_q75_box.jpeg 1600w" width=800 height=361 loading=lazy alt="Featured image of post clickhouse初始化"></a></div><div class=article-details><header class=article-category><a href=/categories/%E5%BC%80%E5%8F%91/ style=background-color:#2a9d8f;color:#fff>开发</a></header><h2 class=article-title><a href=/posts/clickhouse-start/>clickhouse初始化</a></h2><h3 class=article-subtitle>使用docker搭建本地clickhouse使用环境</h3><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Nov 22, 2021</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>阅读时长: 1 分钟</time></div></footer></div></header><section class=article-content><p>总体来看<code>clickhouse</code>的<code>ddl</code>操作方式和<code>mysql</code>很像。比如<code>use database_name</code>， <code>create user ... identified by ''</code>等。</p><h2 id=server>server</h2><h3 id=docker-run>docker run</h3><p>启动clickhouse服务：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker run -d --name clickhouse-server -p 8123:8123 -p 9000:9000 --ulimit <span class=nv>nofile</span><span class=o>=</span>262144:262144 yandex/clickhouse-server:21.8.10.19
</span></span></code></pre></div><h3 id=default-user权限>default user权限</h3><p>默认defualt 用户不能添加新的用户，需要修改default权限，否则会报错<code>Code: 497. DB::Exception: Received from localhost:9000. DB::Exception: default: Not enough privileges. To execute this query it's necessary to have the grant CREATE USER ON *.*. </code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker <span class=nb>exec</span> -it clickhouse-server bash
</span></span><span class=line><span class=cl>apt update -y
</span></span><span class=line><span class=cl>apt install vim
</span></span><span class=line><span class=cl>vi /etc/clickhouse-server/users.xml 
</span></span><span class=line><span class=cl><span class=c1># update  &lt;access_management&gt;1&lt;/access_management&gt;</span>
</span></span><span class=line><span class=cl><span class=nb>exit</span>
</span></span><span class=line><span class=cl>docker restart clickhouse-server
</span></span></code></pre></div><p><figure class=gallery-image style=flex-grow:227;flex-basis:545px><a href=/posts/clickhouse-start/default.png data-size=1550x682><img src=/posts/clickhouse-start/default.png width=1550 height=682 srcset="/posts/clickhouse-start/default_hu801c8cfdfea5b55e3cf77a27138605f8_217042_480x0_resize_box_3.png 480w, /posts/clickhouse-start/default_hu801c8cfdfea5b55e3cf77a27138605f8_217042_1024x0_resize_box_3.png 1024w" loading=lazy alt="access management for default user"></a><figcaption>access management for default user</figcaption></figure></p><h2 id=client>client</h2><h3 id=docker-run-client>docker run client</h3><p>启动clickhouse client，添加用户和数据库：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker run -it --rm --link clickhouse-server:clickhouse-server yandex/clickhouse-client  --host clickhouse-server
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## create database</span>
</span></span><span class=line><span class=cl>fd87688bfa29 :<span class=o>)</span> create database blc
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>CREATE DATABASE blc
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Query id: 19562cda-a1e7-46f9-a3c2-03dec173e15b
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ok.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>0</span> rows in set. Elapsed: 0.009 sec. 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>fd87688bfa29 :<span class=o>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## create user</span>
</span></span><span class=line><span class=cl>fd87688bfa29 :<span class=o>)</span> create user abc IDENTIFIED by <span class=s1>&#39;ssss&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>CREATE USER abc IDENTIFIED WITH sha256_hash BY <span class=s1>&#39;28E51044F4A9CBAE2BBD3D8A9D8C902AD1455D42208277AC4A913B003038A3DC&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Query id: ee533fe8-7d66-428a-bbde-89d0a4d15924
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ok.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>0</span> rows in set. Elapsed: 0.002 sec. 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## grant </span>
</span></span><span class=line><span class=cl>fd87688bfa29 :<span class=o>)</span> GRANT ALL PRIVILEGES ON blc. * TO abc
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>GRANT SHOW, SELECT, INSERT, ALTER, CREATE DATABASE, CREATE TABLE, CREATE VIEW, CREATE DICTIONARY, CREATE FUNCTION, DROP, TRUNCATE, OPTIMIZE, SYSTEM MERGES, SYSTEM TTL MERGES, SYSTEM FETCHES, SYSTEM MOVES, SYSTEM SENDS, SYSTEM REPLICATION QUEUES, SYSTEM DROP REPLICA, SYSTEM SYNC REPLICA, SYSTEM RESTART REPLICA, SYSTEM RESTORE REPLICA, SYSTEM FLUSH DISTRIBUTED, dictGet ON blc.* TO abc
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Query id: cd09b798-f7e0-45f7-8511-9914de75238c
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ok.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>0</span> rows in set. Elapsed: 0.002 sec. 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>fd87688bfa29 :<span class=o>)</span> 
</span></span></code></pre></div><h2 id=sdk>sdk</h2><h3 id=connect-from-golang-client>connect from golang client</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-golang data-lang=golang><span class=line><span class=cl><span class=kn>package</span> <span class=nx>db</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;database/sql&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=s>&#34;github.com/ClickHouse/clickhouse-go&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>globalDB</span> <span class=o>*</span><span class=nx>sql</span><span class=p>.</span><span class=nx>DB</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Init open connection to clickhouse and check a ping cmd.
</span></span></span><span class=line><span class=cl><span class=c1>// url: &#39;tcp://localhost:9000?debug=true&amp;username=abc&amp;password=ssss&amp;database=blc&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Init</span><span class=p>(</span><span class=nx>url</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=kd>func</span><span class=p>(),</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>connect</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>sql</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=s>&#34;clickhouse&#34;</span><span class=p>,</span> <span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>connect</span><span class=p>.</span><span class=nf>Ping</span><span class=p>();</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>globalDB</span> <span class=p>=</span> <span class=nx>connect</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span> <span class=nx>connect</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span> <span class=p>},</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Start create tables if not exists.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>Start</span><span class=p>()</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nf>createTables</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></section><footer class=article-footer><section class=article-tags><a href=/tags/clickhouse/>clickhouse</a>
<a href=/tags/docker/>docker</a>
<a href=/tags/golang/>golang</a>
<a href=/tags/database/>database</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>相关文章</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/posts/cast-befor-opreate/><div class=article-image><img src=/posts/cast-befor-opreate/overflow.ab65bed62260013a011fab3287d99ec9_hu6c6c088e192a628d570732aae3a06660_2744_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy data-key data-hash="md5-q2W+1iJgAToBH6syh9meyQ=="></div><div class=article-details><h2 class=article-title>记一次overflow</h2></div></a></article><article class=has-image><a href=/posts/rand-perm/><div class=article-image><img src=/posts/rand-perm/permutation.aa97a1086ccc396697d1155d9cb2786b_hu807c4137de06b4a20a479ce4481e6a73_266543_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy data-key data-hash="md5-qpehCGzMOWaX0RVdnLJ4aw=="></div><div class=article-details><h2 class=article-title>perm函数</h2></div></a></article><article class=has-image><a href=/posts/permutation-combination/><div class=article-image><img src=/posts/permutation-combination/_hu4d888928ba67d202c9c16f8f815f1495_34652_b2a254b9a0b5a9edca3dd2c50bd3ddc4.webp width=250 height=150 loading=lazy data-key data-hash="md5-bM2Fa2qgVWdh2fVupKMj4Q=="></div><div class=article-details><h2 class=article-title>排列组合</h2></div></a></article><article class=has-image><a href=/posts/go-scheduler/><div class=article-image><img src=/posts/go-scheduler/go-scheduler.e1a745eaaeab4e91bf35e80d8f16ae34_hu91e7c0d50c0fc2958389b4490ae56d77_169307_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy data-key data-hash="md5-4adF6q6rTpG/NegNjxauNA=="></div><div class=article-details><h2 class=article-title>用户线程调度模型</h2></div></a></article><article class=has-image><a href=/posts/two-points/><div class=article-image><img src=/posts/two-points/Image-3.97d3b467ac0a35822abd0d81b6f2f886_hu1cf7d8b8efc5a2b157c3acd03bb293db_51553_250x150_fill_box_smart1_1.gif width=250 height=150 loading=lazy data-key data-hash="md5-l9O0Z6wKNYIqvQ2BtvL4hg=="></div><div class=article-details><h2 class=article-title>快慢指针</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2006 -
2023 鬼画桃符</section><section class=powerby>豆腐炒糖</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#server>server</a><ol><li><a href=#docker-run>docker run</a></li><li><a href=#default-user权限>default user权限</a></li></ol></li><li><a href=#client>client</a><ol><li><a href=#docker-run-client>docker run client</a></li></ol></li><li><a href=#sdk>sdk</a><ol><li><a href=#connect-from-golang-client>connect from golang client</a></li></ol></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>